'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function _typeof(obj) {
  "@babel/helpers - typeof";

  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function (obj) {
      return typeof obj;
    };
  } else {
    _typeof = function (obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return _typeof(obj);
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread2(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function _iterableToArrayLimit(arr, i) {
  if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

  return arr2;
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

var config_1 = {
  fixed: -1,
  // 保留的精度
  returnString: false,
  // 是否返回string类型的结果
  __returnOrigin: false // 是否不包装直接返回

};
var isDebug = false;
var config$1 = {
  config: config_1,
  isDebug: isDebug
};

var _console = {
  log: function log() {
  }
};
var console_1 = _console;

var validate = {
  /**
   * 校验参数计算参数是否合法
   * @param arr
   * @param isMergeTotal 是否是累计运算
   * @returns {[]|*[]}
   */
  mergeArgumentsIsNumber: function mergeArgumentsIsNumber(arr, isMergeTotal) {
    if (!Array.isArray(arr)) {
      console.error('入参不合法');
      return [];
    }

    var _arr = [];
    var len = isMergeTotal === true ? arr.length : 2;

    try {
      // 去除最后一个参数精度
      for (var i = 0; i < len; i++) {
        var _item = arr[i];

        if (typeof _item === 'number') {
          _arr.push(arr[i]);
        } else if (typeof _item === 'string') {
          // 有一些猪一样的后台喜欢把数字反成字符串
          var _temp = Number(arr[i]);

          if (isNaN(_temp)) {
            console.error('字符串转换数字失败，转换结果魏NaN');
          } else {
            _arr.push(Number(arr[i]));
          }
        } else {
          console.error("illegal arguments at position ".concat(i, ", because of ").concat(_item, " is not string or number"));
          return [];
        }
      }
    } catch (e) {
      console.error('参数解析报错', e);
    }

    console_1.log('_arr', _arr);

    return _arr;
  },
  isPosNumber: function isPosNumber(number) {
    // 是否是0和正整数
    return /^(0|\+?[1-9][0-9]*)$/.test(number);
  },
  isEmptyObject: function isEmptyObject(obj) {
    for (var key in obj) {
      return false;
    }

    return true;
  }
};
var validate_1 = validate;

var config = config$1.config;
var isPosNumber = validate_1.isPosNumber,
    mergeArgumentsIsNumber$1 = validate_1.mergeArgumentsIsNumber;
var utils = {
  /**
   * 初始化参数
   * @param options 合并参数，并且进行校验
   * @returns {{}|{returnString: boolean, fixed: number, hex: number}}
   */
  mergeOptions: function mergeOptions(options) {
    if (_typeof(options) !== 'object') {
      console.error("\u914D\u7F6E\u9879\u53C2\u6570".concat(options, "\u4E0D\u5408\u6CD5, \u5C06\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E\u9879"));
      return config;
    }

    var _options = JSON.parse(JSON.stringify(config));

    for (var key in options) {
      var item = options[key]; // 如果配置项不合法，默认使用默认配置

      if (key === 'fixed') {
        // console.log(mergeArgumentsIsNumber)
        _options[key] = !isPosNumber(item) ? config[key] : item;
      }

      if (key === 'returnString') {
        _options[key] = typeof item === 'boolean' ? item : config[key];
      }
    }

    return _options;
  },

  /**
   * 对结果进行包装
   * @param res 结果
   * @param options 配置项
   * @returns {string|Number} 显示的结果
   */
  packResult: function packResult(res, options) {
    if (options && options.returnOrigin === true) {
      // 是否原样返回，用于累计运算中
      return res;
    }

    console_1.log('包装前的结果' + res);

    var fixed = options.fixed,
        returnString = options.returnString;
    var _res = res;
    _res = fixed === -1 ? _res : _res.toFixed(fixed);
    _res = returnString ? _res + '' : _res;

    console_1.log('最终结果：' + _res);

    return _res;
  },
  getChainParams: function getChainParams(number) {
    // const _options = utils.mergeOptions({})
    var _arguments = mergeArgumentsIsNumber$1([number, 0.01], true);

    var _params0 = this._chain.getChainRes();

    var _params1 = _arguments[0];
    return [_params0, _params1];
  }
};
var utils_1 = utils;

var packResult$1 = utils_1.packResult;
var _core = {
  _add: function _add(a, b, options) {
    var _a, _b;

    try {
      _a = (a.toString().split('.')[1] || '').length;
    } catch (e) {
      _a = 0;
    }

    try {
      _b = (b.toString().split('.')[1] || '').length;
    } catch (e) {
      _b = 0;
    }

    var _base = Math.pow(10, Math.max(_a, _b));

    var res = (_core._mul(a, _base, {
      returnOrigin: true
    }) + _core._mul(b, _base, {
      returnOrigin: true
    })) / _base;

    return packResult$1(res, options);
  },

  /**
   * 累计运算
   * @param arr 带计算的数组
   * @param key 带计算的方法
   * @param options
   * @returns {string|Number}
   * @private
   */
  _total: function _total(arr, key, options) {
    var res = arr[0];
    var len = arr.length;

    for (var j = 1; j < len; j++) {
      if (key === '_sub') {
        res = _core._add(res, -arr[j], _objectSpread2(_objectSpread2({}, options), {
          returnOrigin: true
        }));
      } else {
        res = _core[key](res, arr[j], _objectSpread2(_objectSpread2({}, options), {
          returnOrigin: true
        }));
      }
    }

    return packResult$1(res, options);
  },
  _mul: function _mul(a, b, options) {
    var _base = 0;

    try {
      _base += a.toString().split(".")[1].length;
    } catch (e) {}

    try {
      _base += b.toString().split(".")[1].length;
    } catch (e) {}

    var r1 = Number(a.toString().replace(".", ""));
    var r2 = Number(b.toString().replace(".", ""));
    var res = r1 * r2 / Math.pow(10, _base);
    return packResult$1(res, options);
  },
  _div: function _div(a, b, options) {
    var t1 = 0,
        t2 = 0;

    try {
      t1 = a.toString().split(".")[1].length;
    } catch (e) {} //--小数点后的长度


    try {
      t2 = b.toString().split(".")[1].length;
    } catch (e) {} //--小数点后的长度


    var r1 = Number(a.toString().replace(".", "")); //--去除小数点变整数

    var r2 = Number(b.toString().replace(".", "")); //--去除小数点变整数

    var _a = r1 / r2;

    var _b = Math.pow(10, t2 - t1);

    var res = _core._mul(_a, _b, {
      returnOrigin: true
    });

    return packResult$1(res, options); //---整数相除 在乘上10的平方  小数点的长度
  }
};
var core = _core;

var mergeArgumentsIsNumber = validate_1.mergeArgumentsIsNumber;
var mergeOptions = utils_1.mergeOptions,
    getChainParams = utils_1.getChainParams,
    packResult = utils_1.packResult;
var _add = core._add,
    _mul = core._mul,
    _div = core._div,
    _total = core._total;

function Calc(options) {
  this._chain = {
    /**
     * 设置链头
     * @param number
     */
    setChainRes: function setChainRes(number) {
      this.chainRes = number;
    },
    chainRes: 0,
    getChainRes: function getChainRes() {
      return this.chainRes;
    }
  };

  this.val = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var _options = mergeOptions(options);

    return packResult(this._chain.getChainRes(), _options);
  };

  return this;
}
/**
     * 两个数的加法
     * @param a
     * @param b
     * @param options 配置
     * @returns {*}
     */


Calc.prototype.add = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _add(_arguments[0], _arguments[1], _options);
};
/**
     * 两个数的减法
     * @param a
     * @param b
     * @param fixed 保留几位小数
     * @returns {*}
     */


Calc.prototype.sub = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments)); // 减法相当于加上b的负数


  return _add(_arguments[0], -_arguments[1], _options);
};
/**
 * 两个数的乘法
 * @param a
 * @param b
 * @param options
 * @returns {*}
 */


Calc.prototype.mul = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _mul(_arguments[0], _arguments[1], _options);
};
/**
 * 两个数的除法
 * @param a
 * @param b
 * @param options
 * @returns {*|undefined}
 */


Calc.prototype.div = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _div(_arguments[0], _arguments[1], _options);
};

Calc.prototype.adds = function (arr) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(arr, true);

  return _total(_arguments, '_add', _options);
};

Calc.prototype.subs = function (arr) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(arr, true);

  return _total(_arguments, '_sub', _options);
};

Calc.prototype.muls = function (arr) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(arr, true);

  return _total(_arguments, '_mul', _options);
};

Calc.prototype.divs = function (arr) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var _options = mergeOptions(options);

  var _arguments = mergeArgumentsIsNumber(arr, true);

  return _total(_arguments, '_div', _options);
};

function chain(initNumber) {
  var _arguments = mergeArgumentsIsNumber([initNumber, 0.01]);

  var _super = new Calc();

  _super._chain.setChainRes(_arguments[0]);

  return _super;
}

Calc.prototype.cAdd = function (number) {
  var _getChainParams$call = getChainParams.call(this, number),
      _getChainParams$call2 = _slicedToArray(_getChainParams$call, 2),
      a = _getChainParams$call2[0],
      b = _getChainParams$call2[1];

  var _res = _add(a, b, {
    returnOrigin: true
  });

  this._chain.setChainRes(_res);

  return this;
};

Calc.prototype.cSub = function (number) {
  var _getChainParams$call3 = getChainParams.call(this, number),
      _getChainParams$call4 = _slicedToArray(_getChainParams$call3, 2),
      a = _getChainParams$call4[0],
      b = _getChainParams$call4[1];

  var _res = _add(a, -b, {
    returnOrigin: true
  });

  this._chain.setChainRes(_res);

  return this;
};

Calc.prototype.cMul = function (number) {
  var _getChainParams$call5 = getChainParams.call(this, number),
      _getChainParams$call6 = _slicedToArray(_getChainParams$call5, 2),
      a = _getChainParams$call6[0],
      b = _getChainParams$call6[1];

  var _res = _mul(a, b, {
    returnOrigin: true
  });

  this._chain.setChainRes(_res);

  return this;
};

Calc.prototype.cDiv = function (number) {
  var _getChainParams$call7 = getChainParams.call(this, number),
      _getChainParams$call8 = _slicedToArray(_getChainParams$call7, 2),
      a = _getChainParams$call8[0],
      b = _getChainParams$call8[1];

  var _res = _div(a, b, {
    returnOrigin: true
  });

  this._chain.setChainRes(_res);

  return this;
};

var Calc_1 = Calc;
var chain_1 = chain;
var add = Calc.prototype.add;
var mul = Calc.prototype.mul;
var sub = Calc.prototype.sub;
var div = Calc.prototype.div;
var adds = Calc.prototype.adds;
var subs = Calc.prototype.subs;
var muls = Calc.prototype.muls;
var divs = Calc.prototype.divs;
var src = {
  Calc: Calc_1,
  chain: chain_1,
  add: add,
  mul: mul,
  sub: sub,
  div: div,
  adds: adds,
  subs: subs,
  muls: muls,
  divs: divs
};

exports.Calc = Calc_1;
exports.add = add;
exports.adds = adds;
exports.chain = chain_1;
exports.default = src;
exports.div = div;
exports.divs = divs;
exports.mul = mul;
exports.muls = muls;
exports.sub = sub;
exports.subs = subs;
