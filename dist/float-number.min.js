'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var validate = {
  /**
   * 校验参数计算参数是否合法
   * @param arr
   * @param isMergeTotal 是否是累计运算
   * @returns {[]|*[]}
   */
  mergeArgumentsIsNumber: function mergeArgumentsIsNumber(arr, isMergeTotal) {
    if (!Array.isArray(arr)) {
      console.error('入参不合法');
      return [];
    }

    var _arr = [];
    var len = isMergeTotal === true ? arr.length : 2;

    try {
      // 去除最后一个参数精度
      for (var i = 0; i < len; i++) {
        var _item = arr[i];
        console.log(_item);

        if (typeof _item === 'number') {
          _arr.push(arr[i]);
        } else if (typeof _item === 'string') {
          // 有一些猪一样的后台喜欢把数字反成字符串
          var _temp = Number(arr[i]);

          if (isNaN(_temp)) {
            console.error('字符串转换数字失败，转换结果魏NaN');
          } else {
            _arr.push(Number(arr[i]));
          }
        } else {
          console.error("illegal arguments at position ".concat(i, ", because of ").concat(_item, " is not string or number"));
          return [];
        }
      }
    } catch (e) {
      console.error('参数解析报错', e);
    }

    console.log('_arr', _arr);
    return _arr;
  },
  isPosNumber: function isPosNumber(number) {
    // 是否是0和正整数
    return /^(0|\+?[1-9][0-9]*)$/.test(number);
  },
  isEmptyObject: function isEmptyObject(obj) {
    for (var key in obj) {
      return false;
    }

    return true;
  }
};

function _typeof(obj) {
  "@babel/helpers - typeof";

  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function (obj) {
      return typeof obj;
    };
  } else {
    _typeof = function (obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return _typeof(obj);
}

var config_1 = {
  fixed: -1,
  // 保留的精度
  returnString: false // 是否返回string类型的结果

};
var __key = ['add', 'del'];
var config = {
  config: config_1,
  __key: __key
};

var config$1 = config.config;
var isPosNumber = validate.isPosNumber,
    isEmptyObject = validate.isEmptyObject;
var utils = {
  /**
   * 初始化参数
   * @param options 合并参数，并且进行校验
   * @returns {{}|{returnString: boolean, fixed: number, hex: number}}
   */
  mergeOptions: function mergeOptions(options, oldOptions) {
    if (_typeof(options) !== 'object') {
      console.error("\u914D\u7F6E\u9879\u53C2\u6570".concat(options, "\u4E0D\u5408\u6CD5, \u5C06\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E\u9879"));
      return config$1;
    }

    var _options = JSON.parse(JSON.stringify(config$1));

    if (!isEmptyObject(oldOptions)) {
      _options = JSON.parse(JSON.stringify(oldOptions));
    }

    for (var key in options) {
      var item = options[key]; // 如果配置项不合法，默认使用默认配置

      if (key === 'fixed') {
        _options[key] = !isPosNumber(item) ? config$1[key] : item;
      }

      if (key === 'returnString') {
        _options[key] = typeof item === 'boolean' ? item : config$1[key];
      }
    }

    return _options;
  },

  /**
   * 对结果进行包装
   * @param res 结果
   * @param options 配置项
   * @returns {string|Number} 显示的结果
   */
  packResult: function packResult(res, options) {
    // console.log('包装前的结果' + res)
    var fixed = options.fixed,
        returnString = options.returnString; // console.log(returnString)

    var _res = res;
    _res = fixed === -1 ? _res : _res.toFixed(fixed);
    _res = returnString ? _res + '' : _res; // console.log('最终结果：' + _res)

    return _res;
  }
};

var packResult = utils.packResult;
var _core = {
  _add: function _add(a, b, options) {
    var _a, _b;

    try {
      _a = (a.toString().split('.')[1] || '').length;
    } catch (e) {
      _a = 0;
    }

    try {
      _b = (b.toString().split('.')[1] || '').length;
    } catch (e) {
      _b = 0;
    }

    var _base = Math.pow(10, Math.max(_a, _b));

    var res = (a * _base + b * _base) / _base;
    return packResult(res, options);
  },
  _adds: function _adds(arr, options) {
    var res = 0;
    var len = arr.length;

    for (var j = 0; j < len; j++) {
      res = _core._add(arr[j], options);
    }

    return packResult(res, options);
  },
  _mul: function _mul(a, b, options) {
    var _base = 0;

    try {
      _base += a.toString().split(".")[1].length;
    } catch (e) {}

    try {
      _base += b.toString().split(".")[1].length;
    } catch (e) {}

    var r1 = Number(a.toString().replace(".", ""));
    var r2 = Number(b.toString().replace(".", ""));
    var res = r1 * r2 / Math.pow(10, _base);
    return packResult(res, options);
  },
  _div: function _div(a, b, options) {
    var t1, t2;

    try {
      t1 = a.toString().split(".")[1].length;
    } catch (e) {} //--小数点后的长度


    try {
      t2 = b.toString().split(".")[1].length;
    } catch (e) {} //--小数点后的长度


    var r1 = Number(a.toString().replace(".", "")); //--去除小数点变整数

    var r2 = Number(b.toString().replace(".", "")); //--去除小数点变整数

    var res = r1 / r2 * Math.pow(10, t2 - t1);
    return packResult(res, options); //---整数相除 在乘上10的平方  小数点的长度
  }
};
var core = _core;

var mergeArgumentsIsNumber = validate.mergeArgumentsIsNumber;
var mergeOptions = utils.mergeOptions;
var _add = core._add,
    _mul = core._mul,
    _div = core._div,
    _adds = core._adds;
var __global = {};

function Calc(options) {
  __global.options = this._options = mergeOptions(options, __global.options); // 合并配置项

  return this;
}
/**
     * 两个数的加法
     * @param a
     * @param b
     * @param options 配置
     * @returns {*}
     */


Calc.prototype.add = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options, __global.options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _add(_arguments[0], _arguments[1], _options);
};
/**
     * 两个数的减法
     * @param a
     * @param b
     * @param fixed 保留几位小数
     * @returns {*}
     */


Calc.prototype.sub = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options, __global.options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments)); // 减法相当于加上b的负数


  return _add(_arguments[0], -_arguments[1], _options);
};
/**
 * 两个数的乘法
 * @param a
 * @param b
 * @param options
 * @returns {*}
 */


Calc.prototype.mul = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options, __global.options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _mul(_arguments[0], _arguments[1], _options);
};
/**
 * 两个数的除法
 * @param a
 * @param b
 * @param options
 * @returns {*|undefined}
 */


Calc.prototype.div = function (a, b) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var _options = mergeOptions(options, __global.options);

  var _arguments = mergeArgumentsIsNumber(Array.prototype.slice.call(arguments));

  return _div(_arguments[0], _arguments[1], _options);
};

Calc.prototype.adds = function (arr) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var _options = mergeOptions(options, __global.options);

  var _arguments = mergeArgumentsIsNumber(arr, true);

  return _adds(_arguments, _options);
};

var Calc_1 = Calc;
var add = Calc.prototype.add;
var adds = Calc.prototype.adds;
var mul = Calc.prototype.mul;
var sub = Calc.prototype.sub;
var div = Calc.prototype.div;
var src = {
  Calc: Calc_1,
  add: add,
  adds: adds,
  mul: mul,
  sub: sub,
  div: div
};

exports.Calc = Calc_1;
exports.add = add;
exports.adds = adds;
exports.default = src;
exports.div = div;
exports.mul = mul;
exports.sub = sub;
